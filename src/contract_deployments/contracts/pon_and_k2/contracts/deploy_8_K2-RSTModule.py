from web3 import Web3
from web3.middleware import construct_sign_and_send_raw_middleware
import os
import time
import logging

# Account Alias: PON
ACCOUNT_ALIAS = "PON"

# RSTModule contract bytecode
BYTE_CODE = "0x60a06040523060805234801561001457600080fd5b5061001d610022565b6100e1565b600054610100900460ff161561008e5760405162461bcd60e51b815260206004820152602760248201527f496e697469616c697a61626c653a20636f6e747261637420697320696e697469604482015266616c697a696e6760c81b606482015260840160405180910390fd5b60005460ff908116146100df576000805460ff191660ff9081179091556040519081527f7f26b83ff96e1f2b6a682f133852f6798a09c465da95921460cefb38474024989060200160405180910390a15b565b60805161461362000119600039600081816107d101528181610814015281816108bc015281816108ff015261099b01526146136000f3fe6080604052600436106200012b5760003560e01c80638b8abdff11620000ad578063d784d426116200006c578063d784d4261462000375578063e4fac8ac146200039a578063ed87a84514620003d4578063f09a401614620003ec578063f2fde38b146200041157600080fd5b80638b8abdff14620002b55780638bdf000714620002da5780638da5cb5b14620002ff57806395e97eee146200031f578063a9fbd026146200034157600080fd5b80634f1ef28611620000fa5780634f1ef286146200020357806352d1902d146200021a5780635c60da1b1462000241578063715018a614620002635780638526fb65146200027b57600080fd5b80630b5b1ffc146200013057806324b7b95f146200017257806334d62ec214620001995780633659cfe614620001de575b600080fd5b3480156200013d57600080fd5b50620001556200014f36600462001add565b62000436565b6040516001600160a01b0390911681526020015b60405180910390f35b3480156200017f57600080fd5b50620001976200019136600462001b99565b620006a9565b005b348015620001a657600080fd5b50620001cd620001b836600462001c1a565b60cb6020526000908152604090205460ff1681565b604051901515815260200162000169565b348015620001eb57600080fd5b5062000197620001fd36600462001c1a565b620007c7565b620001976200021436600462001c41565b620008b2565b3480156200022757600080fd5b50620002326200098e565b60405190815260200162000169565b3480156200024e57600080fd5b5060ca5462000155906001600160a01b031681565b3480156200027057600080fd5b506200019762000a44565b3480156200028857600080fd5b50620001556200029a36600462001c1a565b60cd602052600090815260409020546001600160a01b031681565b348015620002c257600080fd5b5062000197620002d436600462001c1a565b62000a5c565b348015620002e757600080fd5b5062000197620002f936600462001c1a565b62000cc6565b3480156200030c57600080fd5b506033546001600160a01b031662000155565b3480156200032c57600080fd5b5060c95462000155906001600160a01b031681565b3480156200034e57600080fd5b50620003666200036036600462001cac565b62000cf2565b60405162000169919062001d1a565b3480156200038257600080fd5b50620001976200039436600462001c1a565b62000d94565b348015620003a757600080fd5b5062000155620003b936600462001cac565b60cc602052600090815260409020546001600160a01b031681565b348015620003e157600080fd5b506200019762000dc0565b348015620003f957600080fd5b50620001976200040b36600462001d2f565b62000f19565b3480156200041e57600080fd5b50620001976200043036600462001c1a565b620010f8565b60c9546000906001600160a01b03163314620004835760405162461bcd60e51b815260206004820152600760248201526627b7363c90259960c91b60448201526064015b60405180910390fd5b60c95460405163aa6be30360e01b81526001600160a01b038a81166004830152600092169063aa6be30390602401602060405180830381865afa158015620004cf573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190620004f5919062001d6d565b90506200050481858b62001174565b6001600160a01b03808a16600090815260cd60205260408120549091169081156200061c57600060cc6000846001600160a01b031663534874cf6040518163ffffffff1660e01b8152600401602060405180830381865afa1580156200056e573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019062000594919062001d6d565b81526020810191909152604090810160002080546001600160a01b0319166001600160a01b0393841617905551637c11e7a160e01b81526004810185905290831690637c11e7a190602401600060405180830381600087803b158015620005fa57600080fd5b505af11580156200060f573d6000803e3d6000fd5b5050505081905062000656565b60006200062f848c8c8c8c8c8c6200135d565b6001600160a01b038116600090815260cb60205260409020805460ff191660011790559150505b600092835260cc6020908152604080852080546001600160a01b038086166001600160a01b031992831681179093558f16875260cd90935294208054909116909317909255509050979650505050505050565b60c95460405163e1b1acb760e01b8152600481018590526000916001600160a01b03169063e1b1acb790602401600060405180830381865afa158015620006f4573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526200071e919081019062001d87565b5050505050505050509050336001600160a01b0316816001600160a01b0316146200077a5760405162461bcd60e51b815260206004820152600b60248201526a27b7363c903232b13a37b960a91b60448201526064016200047a565b600084815260ce602052604090206200079583858362001f0c565b5060405184907fea68fb58da0a80e3d460500c6918d6f72f9a5c8e07cf0f00b53b806f50e4491b90600090a250505050565b6001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000163003620008125760405162461bcd60e51b81526004016200047a9062001fda565b7f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03166200085d60008051602062004597833981519152546001600160a01b031690565b6001600160a01b031614620008865760405162461bcd60e51b81526004016200047a9062002026565b62000891816200142c565b60408051600080825260208201909252620008af9183919062001436565b50565b6001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000163003620008fd5760405162461bcd60e51b81526004016200047a9062001fda565b7f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03166200094860008051602062004597833981519152546001600160a01b031690565b6001600160a01b031614620009715760405162461bcd60e51b81526004016200047a9062002026565b6200097c826200142c565b6200098a8282600162001436565b5050565b6000306001600160a01b037f0000000000000000000000000000000000000000000000000000000000000000161462000a305760405162461bcd60e51b815260206004820152603860248201527f555550535570677261646561626c653a206d757374206e6f742062652063616c60448201527f6c6564207468726f7567682064656c656761746563616c6c000000000000000060648201526084016200047a565b506000805160206200459783398151915290565b62000a4e620015ae565b62000a5a60006200160a565b565b60c9546001600160a01b0316331462000aa25760405162461bcd60e51b815260206004820152600760248201526627b7363c90259960c91b60448201526064016200047a565b60c95460405163aa6be30360e01b81526001600160a01b038381166004830152600092169063aa6be30390602401602060405180830381865afa15801562000aee573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019062000b14919062001d6d565b6001600160a01b03808416600090815260cd602052604090205491925016801580159062000ba6575081816001600160a01b031663534874cf6040518163ffffffff1660e01b8152600401602060405180830381865afa15801562000b7d573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019062000ba3919062001d6d565b14155b1562000c9757600060cc6000836001600160a01b031663534874cf6040518163ffffffff1660e01b8152600401602060405180830381865afa15801562000bf1573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019062000c17919062001d6d565b81526020810191909152604090810160002080546001600160a01b0319166001600160a01b0393841617905551637c11e7a160e01b81526004810184905290821690637c11e7a190602401600060405180830381600087803b15801562000c7d57600080fd5b505af115801562000c92573d6000803e3d6000fd5b505050505b600091825260cc602052604090912080546001600160a01b0319166001600160a01b0390921691909117905550565b62000cd0620015ae565b60c980546001600160a01b0319166001600160a01b0392909216919091179055565b60ce602052600090815260409020805462000d0d9062001e86565b80601f016020809104026020016040519081016040528092919081815260200182805462000d3b9062001e86565b801562000d8c5780601f1062000d605761010080835404028352916020019162000d8c565b820191906000526020600020905b81548152906001019060200180831162000d6e57829003601f168201915b505050505081565b62000d9e620015ae565b60ca80546001600160a01b0319166001600160a01b0392909216919091179055565b33600081815260cd60205260409020546001600160a01b03168062000e175760405162461bcd60e51b815260206004820152600c60248201526b139bc81494d508199bdd5b9960a21b60448201526064016200047a565b806001600160a01b031663ed87a8456040518163ffffffff1660e01b8152600401600060405180830381600087803b15801562000e5357600080fd5b505af115801562000e68573d6000803e3d6000fd5b505050506001600160a01b03828116600090815260cd6020908152604080832080546001600160a01b0319169055805163534874cf60e01b8152905160cc9486169263534874cf92600480820193918290030181865afa15801562000ed1573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019062000ef7919062001d6d565b8152602081019190915260400160002080546001600160a01b03191690555050565b600054610100900460ff161580801562000f3a5750600054600160ff909116105b8062000f565750303b15801562000f56575060005460ff166001145b62000fbb5760405162461bcd60e51b815260206004820152602e60248201527f496e697469616c697a61626c653a20636f6e747261637420697320616c72656160448201526d191e481a5b9a5d1a585b1a5e995960921b60648201526084016200047a565b6000805460ff19166001179055801562000fdf576000805461ff0019166101001790555b6001600160a01b038316620010265760405162461bcd60e51b815260206004820152600c60248201526b5a65726f206164647265737360a01b60448201526064016200047a565b620010306200165c565b6200103a62001690565b60c980546001600160a01b0319166001600160a01b038416179055604051620010639062001a01565b604051809103906000f08015801562001080573d6000803e3d6000fd5b5060ca80546001600160a01b0319166001600160a01b0392909216919091179055620010ac836200160a565b8015620010f3576000805461ff0019169055604051600181527f7f26b83ff96e1f2b6a682f133852f6798a09c465da95921460cefb38474024989060200160405180910390a15b505050565b62001102620015ae565b6001600160a01b038116620011695760405162461bcd60e51b815260206004820152602660248201527f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160448201526564647265737360d01b60648201526084016200047a565b620008af816200160a565b60c95460405163e1b1acb760e01b815260048101859052600091829182916001600160a01b03169063e1b1acb790602401600060405180830381865afa158015620011c3573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052620011ed919081019062001d87565b50505096505095505050509250836001600160a01b0316836001600160a01b031614620012465760405162461bcd60e51b815260206004820152600660248201526504e6f205342560d41b60448201526064016200047a565b81851115620012985760405162461bcd60e51b815260206004820152601760248201527f43616e6e6f7420657863656564207072696e6369706c6500000000000000000060448201526064016200047a565b60c954604080516322215bf560e21b8152905142926001600160a01b0316916388856fd49160048083019260209291908290030181865afa158015620012e2573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019062001308919062001d6d565b62001314908362002072565b14620013555760405162461bcd60e51b815260206004820152600f60248201526e496e76616c6964206d696e74696e6760881b60448201526064016200047a565b505050505050565b60ca54600090819062001379906001600160a01b0316620016ba565b604051633d6ca3ad60e21b81529091506001600160a01b0382169063f5b28eb490620013b6908c9088908d908d908d908d908c9060040162002094565b600060405180830381600087803b158015620013d157600080fd5b505af1158015620013e6573d6000803e3d6000fd5b50506040516001600160a01b03841692508b91507fc19fff229897a2c7225c9fd0cac699df5d47f5809b26541d3960baa212a8ce9290600090a398975050505050505050565b620008af620015ae565b7f4910fdfa16fed3260ed0e7147f7cc6da11a60208b5b9406d12a635614ffd91435460ff16156200146c57620010f38362001756565b826001600160a01b03166352d1902d6040518163ffffffff1660e01b8152600401602060405180830381865afa925050508015620014c9575060408051601f3d908101601f19168201909252620014c69181019062001d6d565b60015b6200152e5760405162461bcd60e51b815260206004820152602e60248201527f45524331393637557067726164653a206e657720696d706c656d656e7461746960448201526d6f6e206973206e6f74205555505360901b60648201526084016200047a565b600080516020620045978339815191528114620015a05760405162461bcd60e51b815260206004820152602960248201527f45524331393637557067726164653a20756e737570706f727465642070726f786044820152681a58589b195555525160ba1b60648201526084016200047a565b50620010f3838383620017f5565b6033546001600160a01b0316331462000a5a5760405162461bcd60e51b815260206004820181905260248201527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e657260448201526064016200047a565b603380546001600160a01b038381166001600160a01b0319831681179093556040519116919082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a35050565b600054610100900460ff16620016865760405162461bcd60e51b81526004016200047a90620020eb565b62000a5a62001826565b600054610100900460ff1662000a5a5760405162461bcd60e51b81526004016200047a90620020eb565b6000763d602d80600a3d3981f3363d3d373d3d3d363d730000008260601b60e81c176000526e5af43d82803e903d91602b57fd5bf38260781b17602052603760096000f090506001600160a01b038116620017515760405162461bcd60e51b8152602060048201526016602482015275115490cc4c4d8dce8818dc99585d194819985a5b195960521b60448201526064016200047a565b919050565b6001600160a01b0381163b620017c55760405162461bcd60e51b815260206004820152602d60248201527f455243313936373a206e657720696d706c656d656e746174696f6e206973206e60448201526c1bdd08184818dbdb9d1c9858dd609a1b60648201526084016200047a565b6000805160206200459783398151915280546001600160a01b0319166001600160a01b0392909216919091179055565b62001800836200185b565b6000825111806200180e5750805b15620010f3576200182083836200189d565b50505050565b600054610100900460ff16620018505760405162461bcd60e51b81526004016200047a90620020eb565b62000a5a336200160a565b620018668162001756565b6040516001600160a01b038216907fbc7cd75a20ee27fd9adebab32041f755214dbc6bffa90cc0225b39da2e5c2d3b90600090a250565b6060620018c58383604051806060016040528060278152602001620045b760279139620018ce565b90505b92915050565b6060600080856001600160a01b031685604051620018ed919062002136565b600060405180830381855af49150503d80600081146200192a576040519150601f19603f3d011682016040523d82523d6000602084013e6200192f565b606091505b509150915062001942868383876200194c565b9695505050505050565b60608315620019c0578251600003620019b8576001600160a01b0385163b620019b85760405162461bcd60e51b815260206004820152601d60248201527f416464726573733a2063616c6c20746f206e6f6e2d636f6e747261637400000060448201526064016200047a565b5081620019cc565b620019cc8383620019d4565b949350505050565b815115620019e55781518083602001fd5b8060405162461bcd60e51b81526004016200047a919062001d1a565b612442806200215583390190565b6001600160a01b0381168114620008af57600080fd5b634e487b7160e01b600052604160045260246000fd5b604051601f8201601f1916810167ffffffffffffffff8111828210171562001a675762001a6762001a25565b604052919050565b600067ffffffffffffffff82111562001a8c5762001a8c62001a25565b50601f01601f191660200190565b600062001ab162001aab8462001a6f565b62001a3b565b905082815283838301111562001ac657600080fd5b828260208301376000602084830101529392505050565b600080600080600080600060e0888a03121562001af957600080fd5b873562001b068162001a0f565b9650602088013562001b188162001a0f565b9550604088013562001b2a8162001a0f565b9450606088013562001b3c8162001a0f565b93506080880135925060a0880135915060c088013567ffffffffffffffff81111562001b6757600080fd5b8801601f81018a1362001b7957600080fd5b62001b8a8a82356020840162001a9a565b91505092959891949750929550565b60008060006040848603121562001baf57600080fd5b83359250602084013567ffffffffffffffff8082111562001bcf57600080fd5b818601915086601f83011262001be457600080fd5b81358181111562001bf457600080fd5b87602082850101111562001c0757600080fd5b6020830194508093505050509250925092565b60006020828403121562001c2d57600080fd5b813562001c3a8162001a0f565b9392505050565b6000806040838503121562001c5557600080fd5b823562001c628162001a0f565b9150602083013567ffffffffffffffff81111562001c7f57600080fd5b8301601f8101851362001c9157600080fd5b62001ca28582356020840162001a9a565b9150509250929050565b60006020828403121562001cbf57600080fd5b5035919050565b60005b8381101562001ce357818101518382015260200162001cc9565b50506000910152565b6000815180845262001d0681602086016020860162001cc6565b601f01601f19169290920160200192915050565b602081526000620018c5602083018462001cec565b6000806040838503121562001d4357600080fd5b823562001d508162001a0f565b9150602083013562001d628162001a0f565b809150509250929050565b60006020828403121562001d8057600080fd5b5051919050565b6000806000806000806000806000806101408b8d03121562001da857600080fd5b8a5162001db58162001a0f565b60208c0151909a5062001dc88162001a0f565b60408c015190995062001ddb8162001a0f565b60608c015190985067ffffffffffffffff81111562001df957600080fd5b8b01601f81018d1362001e0b57600080fd5b805162001e1c62001aab8262001a6f565b8181528e602083850101111562001e3257600080fd5b62001e4582602083016020860162001cc6565b80995050505060808b0151955060a08b0151945060c08b0151935060e08b015192506101008b015191506101208b015190509295989b9194979a5092959850565b600181811c9082168062001e9b57607f821691505b60208210810362001ebc57634e487b7160e01b600052602260045260246000fd5b50919050565b601f821115620010f357600081815260208120601f850160051c8101602086101562001eeb5750805b601f850160051c820191505b81811015620013555782815560010162001ef7565b67ffffffffffffffff83111562001f275762001f2762001a25565b62001f3f8362001f38835462001e86565b8362001ec2565b6000601f84116001811462001f76576000851562001f5d5750838201355b600019600387901b1c1916600186901b17835562001fd3565b600083815260209020601f19861690835b8281101562001fa9578685013582556020948501946001909201910162001f87565b508682101562001fc75760001960f88860031b161c19848701351681555b505060018560011b0183555b5050505050565b6020808252602c908201527f46756e6374696f6e206d7573742062652063616c6c6564207468726f7567682060408201526b19195b1959d85d1958d85b1b60a21b606082015260800190565b6020808252602c908201527f46756e6374696f6e206d7573742062652063616c6c6564207468726f7567682060408201526b6163746976652070726f787960a01b606082015260800190565b81810381811115620018c857634e487b7160e01b600052601160045260246000fd5b878152602081018790526001600160a01b03868116604083015285811660608301528416608082015260a0810183905260e060c08201819052600090620020de9083018462001cec565b9998505050505050505050565b6020808252602b908201527f496e697469616c697a61626c653a20636f6e7472616374206973206e6f74206960408201526a6e697469616c697a696e6760a81b606082015260800190565b600082516200214a81846020870162001cc6565b919091019291505056fe608060405234801561001057600080fd5b5061001961001e565b6100dd565b600054610100900460ff161561008a5760405162461bcd60e51b815260206004820152602760248201527f496e697469616c697a61626c653a20636f6e747261637420697320696e697469604482015266616c697a696e6760c81b606482015260840160405180910390fd5b60005460ff908116146100db576000805460ff191660ff9081179091556040519081527f7f26b83ff96e1f2b6a682f133852f6798a09c465da95921460cefb38474024989060200160405180910390a15b565b61235580620000ed6000396000f3fe608060405234801561001057600080fd5b506004361061014d5760003560e01c80637ecebe00116100c3578063d505accf1161007c578063d505accf14610296578063d5f39488146102a9578063dd0081c7146102d4578063dd62ed3e146102de578063ed87a845146102f1578063f5b28eb4146102f957600080fd5b80637ecebe001461023157806384b0196e1461024457806395d89b411461025f578063a457c2d714610267578063a9059cbb1461027a578063bfc12c051461028d57600080fd5b8063313ce56711610115578063313ce567146101c05780633644e515146101cf57806339509351146101d7578063534874cf146101ea57806370a08231146101f35780637c11e7a11461021c57600080fd5b806306fdde0314610152578063095ea7b31461017057806318160ddd1461019357806322f3e2d4146101a557806323b872dd146101ad575b600080fd5b61015a61030c565b6040516101679190611c9e565b60405180910390f35b61018361017e366004611ccd565b61039e565b6040519015158152602001610167565b6035545b604051908152602001610167565b6101836103b8565b6101836101bb366004611cf9565b610560565b60405160128152602001610167565b610197610584565b6101836101e5366004611ccd565b610593565b61019760cd5481565b610197610201366004611d3a565b6001600160a01b031660009081526033602052604090205490565b61022f61022a366004611d57565b6105b5565b005b61019761023f366004611d3a565b6106fd565b61024c61071b565b6040516101679796959493929190611d70565b61015a6107b9565b610183610275366004611ccd565b6107c8565b610183610288366004611ccd565b610843565b61019760ce5481565b61022f6102a4366004611e06565b610851565b60cc546102bc906001600160a01b031681565b6040516001600160a01b039091168152602001610167565b610197620f424081565b6101976102ec366004611e7d565b6109b5565b61022f6109e0565b61022f610307366004611f25565b610d7e565b60606036805461031b90611ffa565b80601f016020809104026020016040519081016040528092919081815260200182805461034790611ffa565b80156103945780601f1061036957610100808354040283529160200191610394565b820191906000526020600020905b81548152906001019060200180831161037757829003601f168201915b5050505050905090565b6000336103ac8185856111f0565b60019150505b92915050565b600080600060cc60009054906101000a90046001600160a01b03166001600160a01b03166395e97eee6040518163ffffffff1660e01b8152600401602060405180830381865afa158015610410573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610434919061202e565b6001600160a01b031663e1b1acb760cd546040518263ffffffff1660e01b815260040161046391815260200190565b600060405180830381865afa158015610480573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526104a8919081019061204b565b505060cc5460cd5460405163393eb22b60e21b81526004810191909152989a5091985030976001600160a01b03909216965063e4fac8ac95505060240192506104ef915050565b602060405180830381865afa15801561050c573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610530919061202e565b6001600160a01b031614801561054e57506001600160a01b03821615155b801561055957508015155b9250505090565b60003361056e858285611314565b61057985858561138e565b506001949350505050565b600061058e611544565b905090565b6000336103ac8185856105a683836109b5565b6105b09190612151565b6111f0565b60cc546001600160a01b031633146106065760405162461bcd60e51b815260206004820152600f60248201526e4f6e6c7920525354206d6f64756c6560881b60448201526064015b60405180910390fd5b61060e6103b8565b1561064c5760405162461bcd60e51b815260206004820152600e60248201526d496e76616c69642075706461746560901b60448201526064016105fd565b6000811161068c5760405162461bcd60e51b815260206004820152600d60248201526c092dcecc2d8d2c840d2dcc8caf609b1b60448201526064016105fd565b8060cd54036106ca5760405162461bcd60e51b815260206004820152600a6024820152690a6c2daca40d2dcc8caf60b31b60448201526064016105fd565b60cd81905560405181907f24028fac18703668a3b22af49de65228066a140a160dc216051f65e85f3a595a90600090a250565b6001600160a01b0381166000908152609960205260408120546103b2565b6000606080600080600060606065546000801b14801561073b5750606654155b61077f5760405162461bcd60e51b81526020600482015260156024820152741152540dcc4c8e88155b9a5b9a5d1a585b1a5e9959605a1b60448201526064016105fd565b61078761154e565b61078f61155d565b60408051600080825260208201909252600f60f81b9b939a50919850469750309650945092509050565b60606037805461031b90611ffa565b600033816107d682866109b5565b9050838110156108365760405162461bcd60e51b815260206004820152602560248201527f45524332303a2064656372656173656420616c6c6f77616e63652062656c6f77604482015264207a65726f60d81b60648201526084016105fd565b61057982868684036111f0565b6000336103ac81858561138e565b834211156108a15760405162461bcd60e51b815260206004820152601d60248201527f45524332305065726d69743a206578706972656420646561646c696e6500000060448201526064016105fd565b60007f6e71edae12b1b97f4d1f60370fef10105fa2faae0126114a169c64845d6126c98888886108d08c61156c565b6040805160208101969096526001600160a01b0394851690860152929091166060840152608083015260a082015260c0810186905260e001604051602081830303815290604052805190602001209050600061092b82611594565b9050600061093b828787876115c1565b9050896001600160a01b0316816001600160a01b03161461099e5760405162461bcd60e51b815260206004820152601e60248201527f45524332305065726d69743a20696e76616c6964207369676e6174757265000060448201526064016105fd565b6109a98a8a8a6111f0565b50505050505050505050565b6001600160a01b03918216600090815260346020908152604080832093909416825291909152205490565b60cc546001600160a01b03163314610a2c5760405162461bcd60e51b815260206004820152600f60248201526e4f6e6c7920525354206d6f64756c6560881b60448201526064016105fd565b60cc5460408051634af4bf7760e11b815290516000926001600160a01b0316916395e97eee9160048083019260209291908290030181865afa158015610a76573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610a9a919061202e565b6001600160a01b0316638b61e3476040518163ffffffff1660e01b8152600401602060405180830381865afa158015610ad7573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610afb919061202e565b9050610b2581610b20836001600160a01b031660009081526033602052604090205490565b6115e9565b60cc5460408051634af4bf7760e11b815290516000926001600160a01b0316916395e97eee9160048083019260209291908290030181865afa158015610b6f573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610b93919061202e565b6001600160a01b0316632131c68c6040518163ffffffff1660e01b8152600401602060405180830381865afa158015610bd0573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610bf4919061202e565b9050610c1981610b20836001600160a01b031660009081526033602052604090205490565b60cc5460408051634af4bf7760e11b815290516000926001600160a01b0316916395e97eee9160048083019260209291908290030181865afa158015610c63573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610c87919061202e565b6001600160a01b031663e1b1acb760cd546040518263ffffffff1660e01b8152600401610cb691815260200190565b600060405180830381865afa158015610cd3573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052610cfb919081019061204b565b5050505050505050509050610d2981610b20836001600160a01b031660009081526033602052604090205490565b60355415610d795760405162461bcd60e51b815260206004820152601a60248201527f5465726d696e6174696f6e206e6f74207375636365737366756c00000000000060448201526064016105fd565b505050565b600054610100900460ff1615808015610d9e5750600054600160ff909116105b80610db85750303b158015610db8575060005460ff166001145b610e1b5760405162461bcd60e51b815260206004820152602e60248201527f496e697469616c697a61626c653a20636f6e747261637420697320616c72656160448201526d191e481a5b9a5d1a585b1a5e995960921b60648201526084016105fd565b6000805460ff191660011790558015610e3e576000805461ff0019166101001790555b60008251118015610e5157506004825111155b610e8b5760405162461bcd60e51b815260206004820152600b60248201526a4d6178203420636861727360a81b60448201526064016105fd565b60008711610ec95760405162461bcd60e51b815260206004820152600b60248201526a5a65726f20737570706c7960a81b60448201526064016105fd565b6001600160a01b038616610f135760405162461bcd60e51b8152602060048201526011602482015270526563697069656e74206973207a65726f60781b60448201526064016105fd565b336001600160a01b03871603610f635760405162461bcd60e51b81526020600482015260156024820152742932b1b4b834b2b73a1034b9903232b83637bcb2b960591b60448201526064016105fd565b336001600160a01b03166395e97eee6040518163ffffffff1660e01b8152600401602060405180830381865afa158015610fa1573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610fc5919061202e565b6001600160a01b0316866001600160a01b0316036110175760405162461bcd60e51b815260206004820152600f60248201526e2932b1b4b834b2b73a1034b990259960891b60448201526064016105fd565b620186a08310156110545760405162461bcd60e51b81526020600482015260076024820152664d696e2031302560c81b60448201526064016105fd565b620f42408311156110925760405162461bcd60e51b81526020600482015260086024820152674d6178203130302560c01b60448201526064016105fd565b60cc80546001600160a01b0319163317905560cd8890556040805180820190915260078152662929aa37b5b2b760c91b60208201526110d19083611729565b6110f76040518060400160405280600581526020016412cc9494d560da1b81525061175e565b6000620f4240611107858a612164565b611111919061217b565b9050600061111f828a61219d565b11156111385761113887611133838b61219d565b6117ab565b6000620f424061114b8362030d40612164565b611155919061217b565b905061116187826117ab565b61116f86611133838561219d565b4260ce556040518a907f24028fac18703668a3b22af49de65228066a140a160dc216051f65e85f3a595a90600090a2505080156111e6576000805461ff0019169055604051600181527f7f26b83ff96e1f2b6a682f133852f6798a09c465da95921460cefb38474024989060200160405180910390a15b5050505050505050565b6001600160a01b0383166112525760405162461bcd60e51b8152602060048201526024808201527f45524332303a20617070726f76652066726f6d20746865207a65726f206164646044820152637265737360e01b60648201526084016105fd565b6001600160a01b0382166112b35760405162461bcd60e51b815260206004820152602260248201527f45524332303a20617070726f766520746f20746865207a65726f206164647265604482015261737360f01b60648201526084016105fd565b6001600160a01b0383811660008181526034602090815260408083209487168084529482529182902085905590518481527f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925910160405180910390a3505050565b600061132084846109b5565b90506000198114611388578181101561137b5760405162461bcd60e51b815260206004820152601d60248201527f45524332303a20696e73756666696369656e7420616c6c6f77616e636500000060448201526064016105fd565b61138884848484036111f0565b50505050565b6001600160a01b0383166113f25760405162461bcd60e51b815260206004820152602560248201527f45524332303a207472616e736665722066726f6d20746865207a65726f206164604482015264647265737360d81b60648201526084016105fd565b6001600160a01b0382166114545760405162461bcd60e51b815260206004820152602360248201527f45524332303a207472616e7366657220746f20746865207a65726f206164647260448201526265737360e81b60648201526084016105fd565b61145f838383611878565b6001600160a01b038316600090815260336020526040902054818110156114d75760405162461bcd60e51b815260206004820152602660248201527f45524332303a207472616e7366657220616d6f756e7420657863656564732062604482015265616c616e636560d01b60648201526084016105fd565b6001600160a01b0380851660008181526033602052604080822086860390559286168082529083902080548601905591517fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef906115379086815260200190565b60405180910390a3611388565b600061058e6118b3565b60606067805461031b90611ffa565b60606068805461031b90611ffa565b6001600160a01b03811660009081526099602052604090208054600181018255905b50919050565b60006103b26115a1611544565b8360405161190160f01b8152600281019290925260228201526042902090565b60008060006115d287878787611927565b915091506115df816119eb565b5095945050505050565b6001600160a01b0382166116495760405162461bcd60e51b815260206004820152602160248201527f45524332303a206275726e2066726f6d20746865207a65726f206164647265736044820152607360f81b60648201526084016105fd565b61165582600083611878565b6001600160a01b038216600090815260336020526040902054818110156116c95760405162461bcd60e51b815260206004820152602260248201527f45524332303a206275726e20616d6f756e7420657863656564732062616c616e604482015261636560f01b60648201526084016105fd565b6001600160a01b03831660008181526033602090815260408083208686039055603580548790039055518581529192917fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef910160405180910390a3505050565b600054610100900460ff166117505760405162461bcd60e51b81526004016105fd906121b0565b61175a8282611b35565b5050565b600054610100900460ff166117855760405162461bcd60e51b81526004016105fd906121b0565b6117a881604051806040016040528060018152602001603160f81b815250611b75565b50565b6001600160a01b0382166118015760405162461bcd60e51b815260206004820152601f60248201527f45524332303a206d696e7420746f20746865207a65726f20616464726573730060448201526064016105fd565b61180d60008383611878565b806035600082825461181f9190612151565b90915550506001600160a01b0382166000818152603360209081526040808320805486019055518481527fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef910160405180910390a35050565b60ce541580611895575060ce54611892906202a300612151565b42115b806118aa575060cc546001600160a01b031633145b610d7957600080fd5b60007f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f6118de611bc4565b6118e6611c1d565b60408051602081019490945283019190915260608201524660808201523060a082015260c00160405160208183030381529060405280519060200120905090565b6000807f7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a083111561195e57506000905060036119e2565b6040805160008082526020820180845289905260ff881692820192909252606081018690526080810185905260019060a0016020604051602081039080840390855afa1580156119b2573d6000803e3d6000fd5b5050604051601f1901519150506001600160a01b0381166119db576000600192509250506119e2565b9150600090505b94509492505050565b60008160048111156119ff576119ff6121fb565b03611a075750565b6001816004811115611a1b57611a1b6121fb565b03611a685760405162461bcd60e51b815260206004820152601860248201527f45434453413a20696e76616c6964207369676e6174757265000000000000000060448201526064016105fd565b6002816004811115611a7c57611a7c6121fb565b03611ac95760405162461bcd60e51b815260206004820152601f60248201527f45434453413a20696e76616c6964207369676e6174757265206c656e6774680060448201526064016105fd565b6003816004811115611add57611add6121fb565b036117a85760405162461bcd60e51b815260206004820152602260248201527f45434453413a20696e76616c6964207369676e6174757265202773272076616c604482015261756560f01b60648201526084016105fd565b600054610100900460ff16611b5c5760405162461bcd60e51b81526004016105fd906121b0565b6036611b68838261225f565b506037610d79828261225f565b600054610100900460ff16611b9c5760405162461bcd60e51b81526004016105fd906121b0565b6067611ba8838261225f565b506068611bb5828261225f565b50506000606581905560665550565b600080611bcf61154e565b805190915015611be6578051602090910120919050565b6065548015611bf55792915050565b7fc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a4709250505090565b600080611c2861155d565b805190915015611c3f578051602090910120919050565b6066548015611bf55792915050565b60005b83811015611c69578181015183820152602001611c51565b50506000910152565b60008151808452611c8a816020860160208601611c4e565b601f01601f19169290920160200192915050565b602081526000611cb16020830184611c72565b9392505050565b6001600160a01b03811681146117a857600080fd5b60008060408385031215611ce057600080fd5b8235611ceb81611cb8565b946020939093013593505050565b600080600060608486031215611d0e57600080fd5b8335611d1981611cb8565b92506020840135611d2981611cb8565b929592945050506040919091013590565b600060208284031215611d4c57600080fd5b8135611cb181611cb8565b600060208284031215611d6957600080fd5b5035919050565b60ff60f81b881681526000602060e081840152611d9060e084018a611c72565b8381036040850152611da2818a611c72565b606085018990526001600160a01b038816608086015260a0850187905284810360c0860152855180825283870192509083019060005b81811015611df457835183529284019291840191600101611dd8565b50909c9b505050505050505050505050565b600080600080600080600060e0888a031215611e2157600080fd5b8735611e2c81611cb8565b96506020880135611e3c81611cb8565b95506040880135945060608801359350608088013560ff81168114611e6057600080fd5b9699959850939692959460a0840135945060c09093013592915050565b60008060408385031215611e9057600080fd5b8235611e9b81611cb8565b91506020830135611eab81611cb8565b809150509250929050565b634e487b7160e01b600052604160045260246000fd5b604051601f8201601f1916810167ffffffffffffffff81118282101715611ef557611ef5611eb6565b604052919050565b600067ffffffffffffffff821115611f1757611f17611eb6565b50601f01601f191660200190565b600080600080600080600060e0888a031215611f4057600080fd5b87359650602088013595506040880135611f5981611cb8565b94506060880135611f6981611cb8565b93506080880135611f7981611cb8565b925060a0880135915060c088013567ffffffffffffffff811115611f9c57600080fd5b8801601f81018a13611fad57600080fd5b8035611fc0611fbb82611efd565b611ecc565b8181528b6020838501011115611fd557600080fd5b8160208401602083013760006020838301015280935050505092959891949750929550565b600181811c9082168061200e57607f821691505b60208210810361158e57634e487b7160e01b600052602260045260246000fd5b60006020828403121561204057600080fd5b8151611cb181611cb8565b6000806000806000806000806000806101408b8d03121561206b57600080fd5b8a5161207681611cb8565b60208c0151909a5061208781611cb8565b60408c015190995061209881611cb8565b60608c015190985067ffffffffffffffff8111156120b557600080fd5b8b01601f81018d136120c657600080fd5b80516120d4611fbb82611efd565b8181528e60208385010111156120e957600080fd5b6120fa826020830160208601611c4e565b80995050505060808b0151955060a08b0151945060c08b0151935060e08b015192506101008b015191506101208b015190509295989b9194979a5092959850565b634e487b7160e01b600052601160045260246000fd5b808201808211156103b2576103b261213b565b80820281158282048414176103b2576103b261213b565b60008261219857634e487b7160e01b600052601260045260246000fd5b500490565b818103818111156103b2576103b261213b565b6020808252602b908201527f496e697469616c697a61626c653a20636f6e7472616374206973206e6f74206960408201526a6e697469616c697a696e6760a81b606082015260800190565b634e487b7160e01b600052602160045260246000fd5b601f821115610d7957600081815260208120601f850160051c810160208610156122385750805b601f850160051c820191505b8181101561225757828155600101612244565b505050505050565b815167ffffffffffffffff81111561227957612279611eb6565b61228d816122878454611ffa565b84612211565b602080601f8311600181146122c257600084156122aa5750858301515b600019600386901b1c1916600185901b178555612257565b600085815260208120601f198616915b828110156122f1578886015182559484019460019091019084016122d2565b508582101561230f5787850151600019600388901b60f8161c191681555b5050505050600190811b0190555056fea2646970667358221220177fb9c29adf24355f74171edefa338d1f8736bddf30d97cffe32bc83e8cf20564736f6c63430008140033360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc416464726573733a206c6f772d6c6576656c2064656c65676174652063616c6c206661696c6564a26469706673582212200f736e8d81268719ca83fc751efb72eb968107b06ffbdb3a77ebd23c5e87e06c64736f6c63430008140033"

logging.basicConfig(filename="/tmp/K2_RSTModule_deployment.log",
                    filemode='a',
                    format='%(asctime)s,%(msecs)d %(name)s %(levelname)s %(message)s',
                    datefmt='%H:%M:%S',
                    level=logging.INFO)

def deploy_K2_RSTModule() -> (bool, dict):
    
    result = {
        "transaction": {},
        "receipt": {},
        "additional_info": {
            "contract_address": "" # Only populates if the contract was deployed successfully
        }
    }
    
    el_uri = os.getenv("EL_RPC_URI", 'http://0.0.0.0:53913')
    sender = get_sender()
    receiver = "0x0000000000000000000000000000000000000000"
    w3 = Web3(Web3.HTTPProvider(el_uri))
    # sleep for 10s before checking again
    time.sleep(10)
    
    # Check if the chain has started before submitting transactions
    block = w3.eth.get_block('latest')
    
    logging.info(f"Latest block number: {block.number}")
    if block.number > 1:
        logging.info("Chain has started, proceeding with PoN-RSTModule deployment")
        sender_account = w3.eth.account.from_key(sender)
        
        w3.middleware_onion.add(construct_sign_and_send_raw_middleware(sender_account))
        
        logging.info("Preparing PoN-RSTModule deployment tx")
        transaction = {
            "from": sender_account.address,
            "to": receiver,
            "value": 0,
            "gasPrice": w3.eth.gas_price,
            'nonce': w3.eth.get_transaction_count(sender_account.address),
            "data": BYTE_CODE
        }
        
        logging.info("Estimating gas")
        estimated_gas = w3.eth.estimate_gas(transaction)
        transaction["gas"] = estimated_gas
        
        logging.info("Sending PoN-RSTModule deployment tx")
        logging.debug(f"Sending deployment tx: {transaction}")
        tx_hash = w3.eth.send_transaction(transaction)
        
        time.sleep(10)
        RSTModule_tx = w3.eth.get_transaction(tx_hash)
        RSTModule_receipt = w3.eth.get_transaction_receipt(tx_hash)
        
        logging.info(f"PoN-RSTModule deployment tx: {RSTModule_tx}")
        logging.info(f"PoN-RSTModule deployment receipt: {RSTModule_receipt}")
        
        if RSTModule_receipt['status'] == 1:
            logging.info("PoN-RSTModule deployment successful")
            result["transaction"] = RSTModule_tx
            result["receipt"] = RSTModule_receipt
            result["additional_info"]["contract_address"] = RSTModule_receipt["contractAddress"]
            return True, result
        else:
            logging.info("PoN-RSTModule deployment failed")
            return False, result
        
    else:
        logging.info("Chain has not started, restarting deployment")
        return False, {}

def get_sender() -> str:
    # Extract the right private key from the list of private keys
    private_keys = os.getenv("PRIVATE_KEYS", ACCOUNT_ALIAS+":ac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80")
    private_keys.split(";")
    sender = ""
    for key in private_keys:
        if key.split(":")[0] == ACCOUNT_ALIAS:
            sender_keys = key.split(":")[1].split(",")
            sender = sender_keys[0]
            break
    return sender

def run_till_deployed() -> dict:
    deployment_status = False
    deployment_details = {}
    while deployment_status is False:
        try:
          deployment_status, deployment_details = deploy_K2_RSTModule()
        except Exception as e:
          logging.error(e)
          logging.error("restarting deployment as previous one failed")
    
    return deployment_details


if __name__ == "__main__":
    
    logging.info("PoN-RSTModule deployment started")
    deployment_details = run_till_deployed()
    logging.info("PoN-RSTModule deployment finished")
    
    print(deployment_details)
